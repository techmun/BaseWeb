!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base","./jquery.fmatter","./grid.utils"],e):e(jQuery)}(function(ne){"use strict";ne.jgrid=ne.jgrid||{},ne.extend(ne.jgrid,{formatCell:function(e,t,r,l,o,a){return void 0!==l.formatter?(t={rowId:"",colModel:l,gid:o.p.id,pos:t,styleUI:"",isExported:!0,exporttype:a},ne.jgrid.isFunction(l.formatter)?l.formatter.call(o,e,t,r):ne.fmatter?ne.fn.fmatter.call(o,l.formatter,e,t,r):e):e},formatCellCsv:function(e,t){e=null==e?"":String(e);try{e=ne.jgrid.stripHtml(e.replace(t._regexsep,t.separatorReplace).replace(/\r\n/g,t.replaceNewLine).replace(/\n/g,t.replaceNewLine))}catch(t){e=""}return-1!==(e=t.escquote?e.replace(t._regexquot,t.escquote+t.quote):e).indexOf(t.separator)&&-1!==e.indexOf(t.qoute)?e:t.quote+e+t.quote},excelCellPos:function(e){for(var t="A".charCodeAt(0),r="Z".charCodeAt(0)-t+1,l="";0<=e;)l=String.fromCharCode(e%r+t)+l,e=Math.floor(e/r)-1;return l},makeNode:function(e,t,r){var l=e.createElement(t);return r&&(r.attr&&ne(l).attr(r.attr),r.children&&ne.each(r.children,function(e,t){l.appendChild(t)}),r.hasOwnProperty("text"))&&l.appendChild(e.createTextNode(r.text)),l},xmlToZip:function(o,e){var a,d,n,i,p,s=this,m=new XMLSerializer,f=-1===m.serializeToString(ne.parseXML(ne.jgrid.excelStrings["xl/worksheets/sheet1.xml"])).indexOf("xmlns:r"),c=[];ne.each(e,function(e,t){if(ne.isPlainObject(t))p=o.folder(e),s.xmlToZip(p,t);else{if(f){for(a=t.childNodes[0],d=a.attributes.length-1;0<=d;d--){var r=a.attributes[d].nodeName,l=a.attributes[d].nodeValue;-1!==r.indexOf(":")&&(c.push({name:r,value:l}),a.removeAttribute(r))}for(d=0,n=c.length;d<n;d++)(i=t.createAttribute(c[d].name.replace(":","_dt_b_namespace_token_"))).value=c[d].value,a.setAttributeNode(i)}p=m.serializeToString(t),p=(p=f?(p=-1===p.indexOf("<?xml")?'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>'+p:p).replace(/_dt_b_namespace_token_/g,":"):p).replace(/<row xmlns="" /g,"<row ").replace(/<cols xmlns="">/g,"<cols>").replace(/<mergeCells xmlns="" /g,"<mergeCells ").replace(/<numFmt xmlns="" /g,"<numFmt ").replace(/<xf xmlns="" /g,"<xf "),o.file(e,p)}})},excelStrings:{"_rels/.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/officeDocument" Target="xl/workbook.xml"/></Relationships>',"xl/_rels/workbook.xml.rels":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Relationships xmlns="http://schemas.openxmlformats.org/package/2006/relationships"><Relationship Id="rId1" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/worksheet" Target="worksheets/sheet1.xml"/><Relationship Id="rId2" Type="http://schemas.openxmlformats.org/officeDocument/2006/relationships/styles" Target="styles.xml"/></Relationships>',"[Content_Types].xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><Types xmlns="http://schemas.openxmlformats.org/package/2006/content-types"><Default Extension="xml" ContentType="application/xml" /><Default Extension="rels" ContentType="application/vnd.openxmlformats-package.relationships+xml" /><Default Extension="jpeg" ContentType="image/jpeg" /><Override PartName="/xl/workbook.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet.main+xml" /><Override PartName="/xl/worksheets/sheet1.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.worksheet+xml" /><Override PartName="/xl/styles.xml" ContentType="application/vnd.openxmlformats-officedocument.spreadsheetml.styles+xml" /></Types>',"xl/workbook.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><workbook xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships"><fileVersion appName="xl" lastEdited="5" lowestEdited="5" rupBuild="24816"/><workbookPr showInkAnnotation="0" autoCompressPictures="0"/><bookViews><workbookView xWindow="0" yWindow="0" windowWidth="25600" windowHeight="19020" tabRatio="500"/></bookViews><sheets><sheet name="Sheet1" sheetId="1" r:id="rId1"/></sheets></workbook>',"xl/worksheets/sheet1.xml":'<?xml version="1.0" encoding="UTF-8" standalone="yes"?><worksheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:r="http://schemas.openxmlformats.org/officeDocument/2006/relationships" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"><sheetData/></worksheet>',"xl/styles.xml":'<?xml version="1.0" encoding="UTF-8"?><styleSheet xmlns="http://schemas.openxmlformats.org/spreadsheetml/2006/main" xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" mc:Ignorable="x14ac" xmlns:x14ac="http://schemas.microsoft.com/office/spreadsheetml/2009/9/ac"><numFmts count="7"><numFmt numFmtId="164" formatCode="#,##0.00_- [$$-45C]"/><numFmt numFmtId="165" formatCode="&quot;£&quot;#,##0.00"/><numFmt numFmtId="166" formatCode="[$€-2] #,##0.00"/><numFmt numFmtId="167" formatCode="0.0%"/><numFmt numFmtId="168" formatCode="#,##0;(#,##0)"/><numFmt numFmtId="169" formatCode="#,##0.00;(#,##0.00)"/><numFmt numFmtId="170" formatCode="yyyy/mm/dd;@"/></numFmts><fonts count="5" x14ac:knownFonts="1"><font><sz val="11" /><name val="Calibri" /></font><font><sz val="11" /><name val="Calibri" /><color rgb="FFFFFFFF" /></font><font><sz val="11" /><name val="Calibri" /><b /></font><font><sz val="11" /><name val="Calibri" /><i /></font><font><sz val="11" /><name val="Calibri" /><u /></font></fonts><fills count="6"><fill><patternFill patternType="none" /></fill><fill/><fill><patternFill patternType="solid"><fgColor rgb="FFD9D9D9" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="FFD99795" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="ffc6efce" /><bgColor indexed="64" /></patternFill></fill><fill><patternFill patternType="solid"><fgColor rgb="ffc6cfef" /><bgColor indexed="64" /></patternFill></fill></fills><borders count="2"><border><left /><right /><top /><bottom /><diagonal /></border><border diagonalUp="false" diagonalDown="false"><left style="thin"><color auto="1" /></left><right style="thin"><color auto="1" /></right><top style="thin"><color auto="1" /></top><bottom style="thin"><color auto="1" /></bottom><diagonal /></border></borders><cellStyleXfs count="1"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" /></cellStyleXfs><cellXfs count="68"><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="2" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="3" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="4" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="5" borderId="0" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="0" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="2" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="3" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="4" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="1" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="2" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="3" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="4" fillId="5" borderId="1" applyFont="1" applyFill="1" applyBorder="1"/><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="left"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="center"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="right"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment horizontal="fill"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment textRotation="90"/></xf><xf numFmtId="0" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyAlignment="1"><alignment wrapText="1"/></xf><xf numFmtId="9"   fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="164" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="165" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="166" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="167" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="168" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="169" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="3" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="4" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="1" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="2" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="170" fontId="0" fillId="0" borderId="0" applyFont="1" applyFill="1" applyBorder="1" xfId="0" applyNumberFormat="1"/><xf numFmtId="49" fontId="0" fillId="0" borderId="0" xfId="0" applyNumberFormat="1"/></cellXfs><cellStyles count="1"><cellStyle name="Normal" xfId="0" builtinId="0" /></cellStyles><dxfs count="0" /><tableStyles count="0" defaultTableStyle="TableStyleMedium9" defaultPivotStyle="PivotStyleMedium4" /></styleSheet>'},excelParsers:[{match:/^\-?\d+\.\d%$/,style:60,fmt:function(e){return e/100}},{match:/^\-?\d+\.?\d*%$/,style:56,fmt:function(e){return e/100}},{match:/^\-?\$[\d,]+.?\d*$/,style:57},{match:/^\-?£[\d,]+.?\d*$/,style:58},{match:/^\-?€[\d,]+.?\d*$/,style:59},{match:/^\-?\d+$/,style:65},{match:/^\-?\d+\.\d{2}$/,style:66},{match:/^\([\d,]+\)$/,style:61,fmt:function(e){return-1*e.replace(/[\(\)]/g,"")}},{match:/^\([\d,]+\.\d{2}\)$/,style:62,fmt:function(e){return-1*e.replace(/[\(\)]/g,"")}},{match:/^\-?[\d,]+$/,style:63},{match:/^\-?[\d,]+\.\d{2}$/,style:64},{match:/^\d{4}\-\d{2}\-\d{2}$/,style:67},{match:/(https?:\/\/(?:www\.|(?!www))[^\s\.]+\.[^\s]{2,}|www\.[^\s]+\.[^\s]{2,})/gi,style:4}],addExcelStyle:function(e,t,r,l){t=ne.extend({numFmtId:"0",fontId:"0",fillId:"0",borderId:"0",applyFont:"1",applyFill:"1",applyBorder:"1",xfId:"0",applyNumberFormat:"0",applyAlignment:"0"},t||{}),r=ne.extend({horizontal:"left",indent:"0",shrinkToFit:"1",textRotation:"0",vertical:"center",wrapText:"0"},r||{}),ne.isEmptyObject(e)&&(e.excel_parsers=!0);var o,a,d,n,i=l.getElementsByTagName("numFmts")[0],p=l.getElementsByTagName("cellXfs")[0],s=null,m=null;for(o in e)e.hasOwnProperty(o)&&(-1!==o.indexOf("format")&&(s=o),-1!==o.indexOf("style"))&&(m=o);return m&&!e[m]&&(a=n=0,s&&e[s]&&(d=ne(i.getElementsByTagName("numFmt")),ne.each(d,function(e,t){n++,a=Math.max(a,parseInt(ne(t).attr("numFmtId"),10))}),d=ne.jgrid.makeNode(l,"numFmt",{attr:{numFmtId:a+1,formatCode:e[s]}}),i.appendChild(d),ne(i).attr("count",n+1)),i=0!==a?a+1+"":"0",n=0,t.numFmtId=i,d="1"===t.applyAlignment?ne.jgrid.makeNode(l,"xf",{attr:t,children:[ne.jgrid.makeNode(l,"alignment",{attr:r})]}):ne.jgrid.makeNode(l,"xf",{attr:t}),p.appendChild(d),n=parseInt(ne(p).attr("count"),10),ne(p).attr("count",n+1),e[m]=n+1),e}}),ne.jgrid.extend({exportToCsv:function(B){B=ne.extend(!0,{separator:",",separatorReplace:" ",quote:'"',escquote:'"',newLine:"\r\n",replaceNewLine:" ",includeCaption:!0,includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.csv",mimetype:"text/csv;charset=utf-8",returnAsString:!1,onBeforeExport:null,treeindent:" ",visibleTreeNodes:!1,loadIndicator:!0},B||{});var T="";this.each(function(){B._regexsep=new RegExp(B.separator,"g"),B._regexquot=new RegExp(B.quote,"g");var e,t,j=this,r=j.p.treeGrid?ne(j).jqGrid("getRowData",null,!0,B.treeindent,B.visibleTreeNodes):j.addLocalData(!0),l=r.length,o=j.p.colModel,a=o.length,d=j.p.colNames,n=0,i="",p="",s="",m="",f="",c=[],u="";ne.jgrid.isFunction(B.loadIndicator)?B.loadIndicator.call(j,"show"):B.loadIndicator&&ne(j).jqGrid("progressBar",{method:"show",loadtype:j.p.loadui,htmlcontent:ne.jgrid.getRegional(j,"defaults.loadtext")});var g=[];if(ne.each(o,function(e,t){t._expcol=!0,void 0===t.exportcol?t.hidden&&(t._expcol=!1):t._expcol=t.exportcol,"cb"!==t.name&&"rn"!==t.name&&"subgrid"!==t.name&&"sc"!==t.name||(t._expcol=!1),t._expcol&&(c.push(ne.jgrid.formatCellCsv(d[e],B)),g.push(t.name))}),B.includeLabels&&(f=c.join(B.separator)+B.newLine),B.collen=c.length,j.p.grouping){var y=!!j.p.groupingView._locgr;j.p.groupingView._locgr=!1,i+=function(s,m){var f="",c=j.p.groupingView,u=[],g=c.groupField.length,y=j.p.colModel,h=y.length,x=0;function I(a,e,t,r){for(var l,o,d=function(e,t){var r,l=!1;if(0===e)l=t[a];else{var o=t[a].idx;if(0===o)l=t[a];else for(r=a;0<=r;r--)if(t[r].idx===o-e){l=t[r];break}}return l}(e,t),n=d.cnt,i=new Array(m.collen),p=0,s=r;s<h;s++)y[s]._expcol&&(o="{0}",ne.each(d.summary,function(){if(this.nm===y[s].name){y[s].summaryTpl&&(o=y[s].summaryTpl),l=this.v,"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?l=this.v/this.vd:this.v&&0<n&&(l=this.v/n));try{this.groupCount=d.cnt,this.groupIndex=d.dataIndex,this.groupValue=d.value,l=j.formatter("",l,s,this)}catch(e){l=this.v}return i[p]=ne.jgrid.formatCellCsv(ne.jgrid.stripHtml(ne.jgrid.template(o,l)),m),!1}}),p++);return i}ne.each(y,function(e,t){for(var r=0;r<g;r++)if(c.groupField[r]===t.name){u[r]=e;break}});var F,b,v=ne.makeArray(c.groupSummary);if(v.reverse(),"local"===j.p.datatype&&!j.p.loadonce){ne(j).jqGrid("groupingSetup");for(var e=ne.jgrid.getMethod("groupingPrepare"),t=0;t<l;t++)e.call(ne(j),r[t],t)}return ne.each(c.groups,function(e,t){x++;try{F=Array.isArray(c.formatDisplayField)&&ne.jgrid.isFunction(c.formatDisplayField[t.idx])?c.formatDisplayField[t.idx].call(j,t.displayValue,t.value,j.p.colModel[u[t.idx]],t.idx,c):j.formatter("",t.displayValue,u[t.idx],t.value)}catch(e){F=t.displayValue}var r,l="";if("string"!=typeof(l=ne.jgrid.isFunction(c.groupText[t.idx])?c.groupText[t.idx].call(j,F,t.cnt,t.summary):ne.jgrid.template(c.groupText[t.idx],F,t.cnt,t.summary))&&"number"!=typeof l&&(l=F),(r="header"===c.groupSummaryPos[t.idx]?I(e,0,c.groups,0):new Array(m.collen))[0]=ne.jgrid.formatCellCsv(ne.jgrid.stripHtml(l),m),f+=r.join(m.separator)+m.newLine,g-1===t.idx){for(var o,a,d,n=c.groups[e+1],l=t.startRow,i=void 0!==n?n.startRow:c.groups[e].startRow+c.groups[e].cnt,p=l;p<i&&s[+p];p++){for(a=s[+p],o=b=0;o<y.length;o++)y[o]._expcol&&(r[b]=ne.jgrid.formatCellCsv(ne.jgrid.formatCell(ne.jgrid.getAccessor(a,y[o].name),o,a,y[o],j,"csv"),m),b++);f+=r.join(m.separator)+m.newLine}if("header"!==c.groupSummaryPos[t.idx]){if(void 0!==n){for(d=0;d<c.groupField.length&&n.dataIndex!==c.groupField[d];d++);x=c.groupField.length-d}for(o=0;o<x;o++)v[o]&&(r=I(e,o,c.groups,0),f+=r.join(m.separator)+m.newLine);x=d}}}),f}(r,B),j.p.groupingView._locgr=y}else for(;n<l;){for(e=r[n],F=[],x=t=0;x<a;x++)o[x]._expcol&&(F[t]=ne.jgrid.formatCellCsv(ne.jgrid.formatCell(ne.jgrid.getAccessor(e,o[x].name),x,e,o[x],j,"csv"),B),t++);i+=F.join(B.separator)+B.newLine,n++}if(r=null,F=new Array(B.collen),B.includeCaption&&j.p.caption){for(n=B.collen;--n;)F[n]="";F[0]=ne.jgrid.formatCellCsv(j.p.caption,B),p+=F.join(B.separator)+B.newLine}if(B.includeGroupHeader&&ne(j).jqGrid("isGroupHeaderOn"))for(var h=j.p.groupHeader,x=0;x<h.length;x++){for(var I=h[x].groupHeaders,n=0,F=[],b=0;b<g.length;b++){for(F[n]="",t=0;t<I.length;t++)I[t].startColumnName===g[b]&&(F[n]=ne.jgrid.formatCellCsv(I[t].titleText,B));n++}s+=F.join(B.separator)+B.newLine}if(B.includeFooter&&j.p.footerrow&&ne(".ui-jqgrid-ftable",this.sDiv).length){for(var v=ne(j).jqGrid("footerData","get"),x=0,F=[];x<B.collen;){var w=g[x];v.hasOwnProperty(w)&&F.push(ne.jgrid.formatCellCsv(ne.jgrid.stripHtml(v[w]),B)),x++}m+=F.join(B.separator)+B.newLine}if(B.includeHeader&&j.p.headerrow){var C=ne(j).jqGrid("headerData","get");for(x=0,F=[];x<B.collen;){var _=g[x];C.hasOwnProperty(_)&&F.push(ne.jgrid.formatCellCsv(ne.jgrid.stripHtml(C[_]),B)),x++}u+=F.join(B.separator)+B.newLine}if(T=p+s+f+u+i+m,ne.jgrid.isFunction(B.loadIndicator)?B.loadIndicator.call(j,"hide"):B.loadIndicator&&ne(j).jqGrid("progressBar",{method:"hide",loadtype:j.p.loadui}),ne.jgrid.isFunction(B.onBeforeExport)&&!(T=B.onBeforeExport.call(j,T)))throw"Before export does not return data!";if(B.returnAsString)return T;-1!==B.mimetype.toUpperCase().indexOf("UTF-8")&&(T="\ufeff"+T),ne.jgrid.saveAs(T,B.fileName,{type:B.mimetype})})},exportToExcel:function(de){de=ne.extend(!0,{includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.xlsx",mimetype:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",maxlength:40,onBeforeExport:null,customizeData:null,replaceStr:null,treeindent:" ",visibleTreeNodes:!1,loadIndicator:!0},de||{}),this.each(function(){for(var e,O,y=this,t=ne.jgrid.excelStrings,q=0,h=ne.parseXML(t["xl/worksheets/sheet1.xml"]),E=h.getElementsByTagName("sheetData")[0],r=ne.parseXML(t["xl/styles.xml"]),t={_rels:{".rels":ne.parseXML(t["_rels/.rels"])},xl:{_rels:{"workbook.xml.rels":ne.parseXML(t["xl/_rels/workbook.xml.rels"])},"workbook.xml":ne.parseXML(t["xl/workbook.xml"]),"styles.xml":r,worksheets:{"sheet1.xml":h}},"[Content_Types].xml":ne.parseXML(t["[Content_Types].xml"])},x=y.p.colModel,l=0,I={body:y.p.treeGrid?ne(y).jqGrid("getRowData",null,!0,de.treeindent,de.visibleTreeNodes):y.addLocalData(!0),header:[],footer:[],width:[],map:[],parser:[],labels:[],hidden:[],mergecell:[]},G=ne.jgrid.addExcelStyle({excel_header_style:""},{fontId:"2",applyAlignment:"1"},{horizontal:"center",vertical:"center"},r).excel_header_style,o=0,L=x.length;o<L;o++)x[o]._expcol=!0,void 0===x[o].exportcol?x[o].hidden&&(x[o]._expcol=!1):x[o]._expcol=x[o].exportcol,void 0===x[o]._colspancell&&(x[o]._colspancell=!1),ne.jgrid.isServiceCol(x[o].name)||!x[o]._expcol?I.hidden.push(x[o].name):(I.header[l]=x[o].name,I.width[l]=5,I.map[l]=o,I.labels[l]=y.p.colNames[o],x[o].hasOwnProperty("exportoptions")?(e={},O={},x[o].exportoptions.excel_format&&(e=ne.jgrid.addExcelStyle({excel_format:x[o].exportoptions.excel_format,excel_style:x[o].exportoptions.excel_style||""},{},{},r)),x[o].exportoptions.excel_header_format&&(O=ne.jgrid.addExcelStyle({excel_header_format:x[o].exportoptions.excel_header_format,excel_header_style:x[o].exportoptions.excel_header_style||""},{fontId:"2",applyAlignment:"1"},{horizontal:"center"},r)),I.parser[o]=ne.extend(e,O),x[o].exportoptions.replace_format&&(I.parser[o].replace_format=x[o].exportoptions.replace_format),x[o].exportoptions.replace_header_format&&(I.parser[o].replace_header_format=x[o].exportoptions.replace_header_format)):I.parser[o]={excel_parsers:!0},l++);if(de.includeFooter||y.p.footerrow)for(l in I.footer=ne(y).jqGrid("footerData","get"),I.footer)I.footer.hasOwnProperty(l)&&(I.footer[l]=ne.jgrid.stripHtml(I.footer[l]));function F(e,t){return ne.jgrid.makeNode(h,"c",{attr:e,children:[ne.jgrid.makeNode(h,"v",{text:t})]})}function b(e,t,r){return ne.jgrid.makeNode(h,"c",{attr:{t:"inlineStr",r:e,s:r=void 0===r?68:r},children:{row:ne.jgrid.makeNode(h,"is",{children:{row:ne.jgrid.makeNode(h,"t",{text:t})}})}})}ne.jgrid.isFunction(de.customizeData)&&de.customizeData.call(y,I);var V,v,R=ne.jgrid.isFunction(de.replaceStr)?de.replaceStr:function(e){return e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[\x00-\x09\x0B\x0C\x0E-\x1F\x7F-\x9F]/g,"")},s=function(e,t,r,l){void 0===r&&(r=!1),void 0===l&&(l=!1),V=q+1,v=ne.jgrid.makeNode(h,"row",{attr:{r:V}});for(var o,a,d=0;d<I.header.length;d++){var n,i,p=ne.jgrid.excelCellPos(d)+""+V,s=(null==(g=Array.isArray(e)&&t?I.labels[d]:ne.jgrid.getAccessor(e,I.header[d]))&&(g=""),t||(g=0===d&&l||l&&""===g?g:ne.jgrid.formatCell(g,I.map[d],e,x[I.map[d]],y,"excel"))&&("&nbsp;"===g||"&#160;"===g||1===g.length&&160===g.charCodeAt(0))&&(g=""),I.width[d]=Math.max(I.width[d],Math.min(parseInt(g.toString().length,10),de.maxlength)),n=null,I.parser[I.map[d]]);if(t&&r)s.replace_header_format&&(g=s.replace_header_format(g)),n=void 0!==s.excel_header_style?"text"===s.excel_header_style?b(p,g):s.excel_header_style<=55?b(p,g,s.excel_header_style):F({r:p,s:s.excel_header_style},g):b(p,g,G),v.appendChild(n);else if(!0!==s.excel_parsers||n)void 0===s.excel_style||t||n||(s.replace_format&&(g=s.replace_format(g)),n="text"===s.excel_style?b(p,g):s.excel_style<=55?b(p,g,s.excel_style):F({r:p,s:s.excel_style},g),v.appendChild(n));else for(var m=0,f=ne.jgrid.excelParsers.length;m<f;m++){var c=ne.jgrid.excelParsers[m];if(g.match&&!g.match(/^0\d+/)&&g.match(c.match)){var u=g,g=g.replace(/[^\d\.\-]/g,"");if(c.fmt&&(g=c.fmt(g)),67===c.style)n=F({t:"d",r:p,s:c.style},g);else if(4===c.style)o=u,a=void 0,(a=document.createElement("div")).innerHTML=o,n=(g="A"===(o=a.firstChild).nodeName?[o.href,o.text]:"#text"===o.nodeName&&[o.textContent,o.textContent])?(a={t:"str",r:p,s:c.style},o='HYPERLINK("'+g[0]+'","'+g[1]+'")',ne.jgrid.makeNode(h,"c",{attr:a,children:[ne.jgrid.makeNode(h,"f",{text:o})]})):b(p,u);else{if(ne.inArray(c.style,["63","64","65","66"])&&15<g.toString().length){n=b(p,u.replace?R(u):u),v.appendChild(n);break}n=F({r:p,s:c.style},g)}v.appendChild(n);break}}n||(g.match&&(i=g.match(/^-?([1-9]\d+)(\.(\d+))?$/)),n="number"==typeof g&&g.toString().length<=15||i&&i[1].length+(i[2]?i[3].length:0)<=15?F({t:"n",r:p},g):b(p,g.replace?R(g):g),v.appendChild(n))}E.appendChild(v),q++};ne.jgrid.isFunction(de.loadIndicator)?de.loadIndicator.call(y,"show"):de.loadIndicator&&ne(y).jqGrid("progressBar",{method:"show",loadtype:y.p.loadui,htmlcontent:ne.jgrid.getRegional(y,"defaults.loadtext")}),ne("sheets sheet",t.xl["workbook.xml"]).attr("name",de.sheetName);var a,d,n,i,p,m,f=0,c=[],u={};if(de.includeGroupHeader&&ne(y).jqGrid("isGroupHeaderOn"))for(a=y.p.groupHeader,n=0;n<a.length;n++){var g,j,w,C,_=a[n].groupHeaders,M=a[n].useColSpanStyle&&1===a.length,z=[],$=[],X=[];if(f++,M)for(g=0;g<_.length;g++)for(d=_[g].startColumnName,j=_[g].numberOfColumns,C=w=ne.jgrid.getElemByAttrVal(x,"name",d,!0);C<w+_[g].numberOfColumns;C++)X[x[C].name]=d,-1!==(i=I.header.indexOf(x[C].name))&&z.push(i);for(o=0;o<I.header.length;o++){for(u[d=I.header[o]]=M?I.labels[o]:"",m=p=-1,g=0;g<_.length;g++)if(_[g].startColumnName===d){for($.push(d),u[d]=_[g].titleText,j=_[g].numberOfColumns,C=w=ne.jgrid.getElemByAttrVal(x,"name",d,!0);C<w+_[g].numberOfColumns;C++)!0===x[C].hidden&&j--;p=ne.jgrid.excelCellPos(o)+f,m=ne.jgrid.excelCellPos(o+j-1)+f,c.push({ref:p+":"+m})}-1===p&&-1===m&&M&&-1===z.indexOf(o)&&(p=ne.jgrid.excelCellPos(o)+f,m=ne.jgrid.excelCellPos(o)+(f+1),c.push({ref:p+":"+m}))}if($.length<_.length)for(g=0;g<I.hidden.length;g++){var B=ne.jgrid.inColumnHeader(I.hidden[g],_);if(0<=B)for(var T in d=I.hidden[g],X)if(X[T]===d&&u[T]){for(u[T]=_[B].titleText,i=I.header.indexOf(T),j=_[B].numberOfColumns,C=w=ne.jgrid.getElemByAttrVal(x,"name",d,!0);C<w+_[B].numberOfColumns;C++)!0===x[C].hidden&&j--;p=ne.jgrid.excelCellPos(i)+f,m=ne.jgrid.excelCellPos(i+j-1)+f,c.push({ref:p+":"+m});break}}s(u,!0,!0)}if(de.includeLabels)if(y.p.colSpanHeader.length){for(f++,a=y.p.colSpanHeader,u={},o=0;o<I.header.length;o++)for(u[d=I.header[o]]=I.labels[o],n=0;n<a.length;n++)(_=a[n]).startColumnName===d&&(u[d]=_.titleText,p=ne.jgrid.excelCellPos(o)+f,m=ne.jgrid.excelCellPos(o+_.numberOfColumns-1)+f,c.push({ref:p+":"+m}));s(u,!0,!0)}else s(I.header,!0,!0);if((c=I.mergecell.length?c.concat(I.mergecell):c).length){var U=ne.jgrid.makeNode(h,"mergeCells",{attr:{count:c.length}});for(ne("worksheet",h).append(U),l=0;l<c.length;l++)U.appendChild(ne.jgrid.makeNode(h,"mergeCell",{attr:c[l]}))}if(de.includeHeader||y.p.headerrow){var k=ne(y).jqGrid("headerData","get");for(l in k)k.hasOwnProperty(l)&&(k[l]=ne.jgrid.stripHtml(k[l]));ne.isEmptyObject(k)||(s(k,!0),ne("row",h).last().find("c").attr("s","2"))}if(y.p.grouping){var Z=!!y.p.groupingView._locgr,W=(y.p.groupingView._locgr=!1,I.body),N=y.p.groupingView,J=[],K=N.groupField.length,Q=x.length,S=0;function Y(a,e,t,r){for(var l,o,d=function(e,t){var r,l=!1;if(0===e)l=t[a];else{var o=t[a].idx;if(0===o)l=t[a];else for(r=a;0<=r;r--)if(t[r].idx===o-e){l=t[r];break}}return l}(e,t),n=d.cnt,i=ee(I.header),p=r;p<Q;p++)x[p]._expcol&&(o="{0}",ne.each(d.summary,function(){if(this.nm===x[p].name){x[p].summaryTpl&&(o=x[p].summaryTpl),l=this.v,"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?l=this.v/this.vd:this.v&&0<n&&(l=this.v/n));try{this.groupCount=d.cnt,this.groupIndex=d.dataIndex,this.groupValue=d.value}catch(e){l=this.v}return i[this.nm]=ne.jgrid.stripHtml(ne.jgrid.template(o,l)),!1}}));return i}function ee(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}ne.each(x,function(e,t){for(var r=0;r<K;r++)if(N.groupField[r]===t.name){J[r]=e;break}});var A,te=ne.makeArray(N.groupSummary);if(te.reverse(),"local"===y.p.datatype&&!y.p.loadonce){ne(y).jqGrid("groupingSetup");for(var re=ne.jgrid.getMethod("groupingPrepare"),H=0;H<I.body.length;H++)re.call(ne(y),I.body[H],H)}ne.each(N.groups,function(e,t){S++;try{A=Array.isArray(N.formatDisplayField)&&ne.jgrid.isFunction(N.formatDisplayField[t.idx])?N.formatDisplayField[t.idx].call(y,t.displayValue,t.value,y.p.colModel[J[t.idx]],t.idx,N):y.formatter("",t.displayValue,J[t.idx],t.value)}catch(e){A=t.displayValue}var r="",l=("string"!=typeof(r=ne.jgrid.isFunction(N.groupText[t.idx])?N.groupText[t.idx].call(y,A,t.cnt,t.summary):ne.jgrid.template(N.groupText[t.idx],A,t.cnt,t.summary))&&"number"!=typeof r&&(r=A),"header"===N.groupSummaryPos[t.idx]?Y(e,0,N.groups,0):ee(I.header));if(l[Object.keys(l)[0]]=ne.jgrid.stripHtml(new Array(5*t.idx).join(" ")+r),s(l,!1,!1,!0),K-1===t.idx){for(var o,a,d=N.groups[e+1],r=t.startRow,n=void 0!==d?d.startRow:N.groups[e].startRow+N.groups[e].cnt,i=r;i<n&&W[+i];i++){var p=W[+i];s(p,!1)}if("header"!==N.groupSummaryPos[t.idx]){if(void 0!==d){for(a=0;a<N.groupField.length&&d.dataIndex!==N.groupField[a];a++);S=N.groupField.length-a}for(o=0;o<S;o++)te[o]&&(l=Y(e,o,N.groups,0),s(l,!1,!1,!0));S=a}}}),y.p.groupingView._locgr=Z}else for(var D=0,le=I.body.length;D<le;D++)s(I.body[D],!1);if((de.includeFooter||y.p.footerrow)&&!ne.isEmptyObject(I.footer))if(Array.isArray(I.footer))for(D=0;D<I.footer.length;D++)s(I.footer[D],!0),ne("row",h).last().find("c").attr("s","2");else s(I.footer,!0),ne("row",h).last().find("c").attr("s","2");var oe=ne.jgrid.makeNode(h,"cols");for(ne("worksheet",h).prepend(oe),l=0,L=I.width.length;l<L;l++)oe.appendChild(ne.jgrid.makeNode(h,"col",{attr:{min:l+1,max:l+1,width:I.width[l],customWidth:1}}));ne.jgrid.isFunction(de.onBeforeExport)&&de.onBeforeExport.call(y,t,q),I=null;try{var P=new JSZip,ae={type:"blob",mimeType:de.mimetype};ne.jgrid.xmlToZip(P,t),P.generateAsync?P.generateAsync(ae).then(function(e){ne.jgrid.saveAs(e,de.fileName,{type:de.mimetype})}):ne.jgrid.saveAs(P.generate(ae),de.fileName,{type:de.mimetype})}catch(e){throw e}finally{ne.jgrid.isFunction(de.loadIndicator)?de.loadIndicator.call(y,"hide"):de.loadIndicator&&ne(y).jqGrid("progressBar",{method:"hide",loadtype:y.p.loadui})}})},exportToPdf:function(V){return V=ne.extend(!0,{title:null,orientation:"portrait",pageSize:"A4",description:null,onBeforeExport:null,download:"download",includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,fileName:"jqGridExport.pdf",mimetype:"application/pdf",treeindent:"-",visibleTreeNodes:!1,centerTableOnPage:!1,loadIndicator:!0},V||{}),this.each(function(){var e,t,r,s=this,m=[],l=s.p.colModel,n={},i=s.p.treeGrid?ne(s).jqGrid("getRowData",null,!0,V.treeindent,V.visibleTreeNodes):s.addLocalData(!0),f=[],p=0,c=[],o=[],a=[],u={};for(ne.jgrid.isFunction(V.loadIndicator)?V.loadIndicator.call(s,"show"):V.loadIndicator&&ne(s).jqGrid("progressBar",{method:"show",loadtype:s.p.loadui,htmlcontent:ne.jgrid.getRegional(s,"defaults.loadtext")}),e=0,D=l.length;e<D;e++)l[e]._expcol=!0,void 0===l[e].exportcol?l[e].hidden&&(l[e]._expcol=!1):l[e]._expcol=l[e].exportcol,!ne.jgrid.isServiceCol(l[e].name)&&l[e]._expcol&&(n={text:s.p.colNames[e],style:"tableHeader"},o.push(n),f[p]=l[e].name,c[p]=e,a.push(l[e].width),u[l[e].name]=l[e].align||"left",p++);if(V.includeGroupHeader&&ne(s).jqGrid("isGroupHeaderOn"))for(r=s.p.groupHeader,p=0;p<r.length;p++){for(var d=[],g=r[p].groupHeaders,O=r[p].useColSpanStyle,y=0;y<l.length;y++){var h=!0;for(ne.jgrid.isServiceCol(l[y].name)||!l[y]._expcol?h=!1:n=O?{text:s.p.colNames[y],style:"tableHeader",rowSpan:2,verticalAlign:"center"}:{text:"",style:"tableHeader"},t=0;t<g.length;t++)if(g[t].startColumnName===l[y].name){for(var x=g[t].numberOfColumns,I=y;I<y+g[t].numberOfColumns;I++)!0===l[I].hidden&&x--;!(n={text:g[t].titleText,colSpan:x,style:"tableHeader"})===h&&0<x&&(h=!0,y+=g[t].numberOfColumns-x)}h&&d.push(n)}m.push(d)}if(V.includeLabels)if(s.p.colSpanHeader.length){for(r=s.p.colSpanHeader,d=[],y=0;y<f.length;y++){for(n={text:s.p.colNames[y],style:"tableHeader",verticalAlign:"center"},t=0;t<r.length;t++)r[t].startColumnName===f[y]&&(n={text:r[t].titleText,colSpan:r[t].numberOfColumns,style:"tableHeader"});d.push(n),e++}m.push(d)}else m.push(o);if(V.includeHeader&&s.p.headerrow){for(var q=ne(s).jqGrid("headerData","get"),o=[],y=0;y<f.length;y++)n={text:ne.jgrid.stripHtml(ne.jgrid.getAccessor(q,f[y])),style:"tableFooter",alignment:u[f[y]]},o.push(n);m.push(o)}if(s.p.grouping){var F=!!s.p.groupingView._locgr,b=(s.p.groupingView._locgr=!1,i),v=s.p.groupingView,j=[],w=v.groupField.length,C=s.p.colModel,E=C.length,_=0;function B(e,t,r){var l,o=0,a=[];void 0===r&&(r=!1);for(var d=0;d<f.length;d++)l=e[f[d]],n={text:null==l||""===l?"":!t||0===d&&r?l:ne.jgrid.formatCell(l+"",c[o],i[p],C[c[o]],s,"pdf"),alignment:u[d],style:"tableBody"},a.push(n),o++;return a}function T(a,e,t,r){for(var l,o,d=function(e,t){var r,l=!1;if(0===e)l=t[a];else{var o=t[a].idx;if(0===o)l=t[a];else for(r=a;0<=r;r--)if(t[r].idx===o-e){l=t[r];break}}return l}(e,t),n=d.cnt,i=k(f),p=r;p<E;p++)C[p]._expcol&&(o="{0}",ne.each(d.summary,function(){if(this.nm===C[p].name){C[p].summaryTpl&&(o=C[p].summaryTpl),l=this.v,"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?l=this.v/this.vd:this.v&&0<n&&(l=this.v/n));try{this.groupCount=d.cnt,this.groupIndex=d.dataIndex,this.groupValue=d.value}catch(e){l=this.v}return i[this.nm]=ne.jgrid.stripHtml(ne.jgrid.template(o,l)),!1}}));return i}function k(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}ne.each(C,function(e,t){for(var r=0;r<w;r++)if(v.groupField[r]===t.name){j[r]=e;break}});var N,S=ne.makeArray(v.groupSummary);if(S.reverse(),"local"===s.p.datatype&&!s.p.loadonce){ne(s).jqGrid("groupingSetup");for(var G=ne.jgrid.getMethod("groupingPrepare"),A=0;A<i.length;A++)G.call(ne(s),i[A],A)}ne.each(v.groups,function(e,t){_++;try{N=Array.isArray(v.formatDisplayField)&&ne.jgrid.isFunction(v.formatDisplayField[t.idx])?v.formatDisplayField[t.idx].call(s,t.displayValue,t.value,s.p.colModel[j[t.idx]],t.idx,v):s.formatter("",t.displayValue,j[t.idx],t.value)}catch(e){N=t.displayValue}var r="",l=("string"!=typeof(r=ne.jgrid.isFunction(v.groupText[t.idx])?v.groupText[t.idx].call(s,N,t.cnt,t.summary):ne.jgrid.template(v.groupText[t.idx],N,t.cnt,t.summary))&&"number"!=typeof r&&(r=N),"header"===v.groupSummaryPos[t.idx]?T(e,0,v.groups,0):k(f));if(l[Object.keys(l)[0]]=ne.jgrid.stripHtml(new Array(5*t.idx).join(" ")+r),m.push(B(l,!0,!0)),w-1===t.idx){for(var o,a,d=v.groups[e+1],r=t.startRow,n=void 0!==d?d.startRow:v.groups[e].startRow+v.groups[e].cnt,i=r;i<n&&b[+i];i++){var p=b[+i];m.push(B(p,!0))}if("header"!==v.groupSummaryPos[t.idx]){if(void 0!==d){for(a=0;a<v.groupField.length&&d.dataIndex!==v.groupField[a];a++);_=v.groupField.length-a}for(o=0;o<_;o++)S[o]&&(l=T(e,o,v.groups,0),m.push(B(l,!0,!0)));_=a}}}),s.p.groupingView._locgr=F}else for(var H,p=0,D=i.length;p<D;p++){for(o=[],H=i[p],y=t=0;y<f.length;y++)n={text:null==H[f[y]]?"":ne.jgrid.stripHtml(ne.jgrid.formatCell(ne.jgrid.getAccessor(H,f[y])+"",c[t],i[p],l[c[t]],s,"pdf")),alignment:u[f[y]],style:"tableBody"},o.push(n),t++;m.push(o)}if(V.includeFooter&&s.p.footerrow){var L=ne(s).jqGrid("footerData","get");for(o=[],y=0;y<f.length;y++)n={text:ne.jgrid.stripHtml(ne.jgrid.getAccessor(L,f[y])),style:"tableFooter",alignment:u[f[y]]},o.push(n);m.push(o)}F={style:"tableExample",widths:a,table:{headerRows:null!=r?0:1,body:m}},V.centerTableOnPage&&(F={columns:[{width:"*",text:""},{style:"tableExample",width:"auto",widths:a,table:{headerRows:null!=r?0:1,body:m},alignment:"center"},{width:"*",text:""}]}),F={pageSize:V.pageSize,pageOrientation:V.orientation,content:[F],styles:{tableHeader:{bold:!0,fontSize:11,color:"#2e6e9e",fillColor:"#dfeffc",alignment:"center"},tableBody:{fontSize:10},tableFooter:{bold:!0,fontSize:11,color:"#2e6e9e",fillColor:"#dfeffc"},title:{alignment:"center",fontSize:15},description:{}},defaultStyle:{fontSize:10}},V.description&&F.content.unshift({text:V.description,style:"description",margin:[0,0,0,12]}),V.title&&F.content.unshift({text:V.title,style:"title",margin:[0,0,0,12]}),ne.jgrid.isFunction(V.onBeforeExport)&&V.onBeforeExport.call(s,F);try{var P=pdfMake.createPdf(F);P.getDataUrl(function(e){ne.jgrid.isFunction(V.loadIndicator)?V.loadIndicator.call(s,"hide"):V.loadIndicator&&ne(s).jqGrid("progressBar",{method:"hide",loadtype:s.p.loadui})}),"open"===V.download?P.open():P.getBuffer(function(e){ne.jgrid.saveAs(e,V.fileName,{type:V.mimetype})})}catch(e){throw e}})},exportToHtml:function(p){var s;return p=ne.extend(!0,{title:"",onBeforeExport:null,includeLabels:!0,includeGroupHeader:!0,includeFooter:!0,includeHeader:!0,tableClass:"jqgridprint",autoPrint:!1,topText:"",bottomText:"",returnAsString:!1,treeindent:"&nbsp;",visibleTreeNodes:!1,loadIndicator:!0},p||{}),this.each(function(){for(var v=this,m=v.p.colModel,e=0,j={body:v.p.treeGrid?ne(v).jqGrid("getRowData",null,!0,p.treeindent,p.visibleTreeNodes):v.addLocalData(!0),header:[],footer:[],width:[],map:[],align:[]},t=0,r=m.length;t<r;t++)m[t]._expcol=!0,void 0===m[t].exportcol?m[t].hidden&&(m[t]._expcol=!1):m[t]._expcol=m[t].exportcol,"cb"!==m[t].name&&"rn"!==m[t].name&&"subgrid"!==m[t].name&&"sc"!==m[t].name&&m[t]._expcol&&(j.header[e]=m[t].name,j.width[e]=m[t].width,j.map[e]=t,j.align[e]=m[t].align||"left",e++);function l(e){return o.href=e,-1===(e=o.host).indexOf("/")&&0!==o.pathname.indexOf("/")&&(e+="/"),o.protocol+"//"+e+o.pathname+o.search}var o=document.createElement("a"),w=function(e,t,r,l,o){for(var a,d,n="<tr>",i=0,p=j.header.length;i<p&&(d=o?' colspan= "'+j.header.length+'" style=text-align:left':!0===l?" style=width:"+j.width[i]+"px;text-align:"+j.align[i]+";":" style=text-align:"+j.align[i]+";",a=j.header[i],e.hasOwnProperty(a)&&(n+="<"+t+d+">"+(r?ne.jgrid.formatCell(ne.jgrid.getAccessor(e,a),j.map[i],e,m[j.map[i]],v,"html"):e[a])+"</"+t+">"),!o);i++);return n+"</tr>"};ne.jgrid.isFunction(p.loadIndicator)?p.loadIndicator.call(v,"show"):p.loadIndicator&&ne(v).jqGrid("progressBar",{method:"show",loadtype:v.p.loadui,htmlcontent:ne.jgrid.getRegional(v,"defaults.loadtext")});var a='<table class="'+p.tableClass+'">';if(p.includeLabels&&(a+="<thead>"+function(){for(var e="<tr>",t=0,r=j.header.length;t<r;t++)e+="<th style=width:"+j.width[t]+"px;>"+v.p.colNames[j.map[t]]+"</th>";return e+"</tr>"}()+"</thead>"),a+="<tbody>",p.includeHeader&&v.p.headerrow&&(d=ne(v).jqGrid("headerData","get",null,!1),a+=w(d,"td",!1)),v.p.grouping){var d=!!v.p.groupingView._locgr;v.p.groupingView._locgr=!1,a+=function(f){var c=v.p.groupingView,u=[],g=c.groupField.length,s=m.length,y=0,h="";function x(a,e,t,r){for(var l,o,d=function(e,t){var r,l=!1;if(0===e)l=t[a];else{var o=t[a].idx;if(0===o)l=t[a];else for(r=a;0<=r;r--)if(t[r].idx===o-e){l=t[r];break}}return l}(e,t),n=d.cnt,i=I(j.header),p=r;p<s;p++)m[p]._expcol&&(o="{0}",ne.each(d.summary,function(){if(this.nm===m[p].name){m[p].summaryTpl&&(o=m[p].summaryTpl),l=this.v,"string"==typeof this.st&&"avg"===this.st.toLowerCase()&&(this.sd&&this.vd?l=this.v/this.vd:this.v&&0<n&&(l=this.v/n));try{this.groupCount=d.cnt,this.groupIndex=d.dataIndex,this.groupValue=d.value}catch(e){l=this.v}return i[this.nm]=ne.jgrid.stripHtml(ne.jgrid.template(o,l)),!1}}));return i}function I(e){for(var t={},r=0;r<e.length;r++)t[e[r]]="";return t}ne.each(m,function(e,t){for(var r=0;r<g;r++)if(c.groupField[r]===t.name){u[r]=e;break}});var F,b=ne.makeArray(c.groupSummary);if(b.reverse(),"local"===v.p.datatype&&!v.p.loadonce){ne(v).jqGrid("groupingSetup");for(var e=ne.jgrid.getMethod("groupingPrepare"),t=0;t<j.body.length;t++)e.call(ne(v),j.body[t],t)}return ne.each(c.groups,function(e,t){y++;try{F=Array.isArray(c.formatDisplayField)&&ne.jgrid.isFunction(c.formatDisplayField[t.idx])?c.formatDisplayField[t.idx].call(v,t.displayValue,t.value,v.p.colModel[u[t.idx]],t.idx,c):v.formatter("",t.displayValue,u[t.idx],t.value)}catch(e){F=t.displayValue}var r="";"string"!=typeof(r=ne.jgrid.isFunction(c.groupText[t.idx])?c.groupText[t.idx].call(v,F,t.cnt,t.summary):ne.jgrid.template(c.groupText[t.idx],F,t.cnt,t.summary))&&"number"!=typeof r&&(r=F);var l,o=!1,a=("header"===c.groupSummaryPos[t.idx]?l=x(e,0,c.groups,0):(l=I(j.header),o=!0),Object.keys(l));if(l[a[0]]=new Array(5*t.idx).join(" ")+r,h+=w(l,"td",!0,1===y,o),g-1===t.idx){for(var d,n,i=c.groups[e+1],a=t.startRow,p=void 0!==i?i.startRow:c.groups[e].startRow+c.groups[e].cnt,s=a;s<p&&f[+s];s++){var m=f[+s];h+=w(m,"td",!0)}if("header"!==c.groupSummaryPos[t.idx]){if(void 0!==i){for(n=0;n<c.groupField.length&&i.dataIndex!==c.groupField[n];n++);y=c.groupField.length-n}for(d=0;d<y;d++)b[d]&&(l=x(e,d,c.groups,0),h+=w(l,"td",!0));y=n}}}),h}(j.body),v.p.groupingView._locgr=d}else for(e=0,r=j.body.length;e<r;e++)a+=w(j.body[e],"td",!0,0===e);if(p.includeFooter&&v.p.footerrow&&(j.footer=ne(v).jqGrid("footerData","get",null,!1),a+=w(j.footer,"td",!1)),a+="</tbody></table>",p.returnAsString)s=a;else{var n=window.open("",""),i=(n.document.close(),p.title?"<title>"+p.title+"</title>":"");ne("style, link").each(function(){var e;i+=("link"===(e=ne(e=this).clone()[0]).nodeName.toLowerCase()&&(e.href=l(e.href)),e.outerHTML)});try{n.document.head.innerHTML=i}catch(e){ne(n.document.head).html(i)}n.document.body.innerHTML=(p.title?"<h1>"+p.title+"</h1>":"")+"<div>"+(p.topText||"")+"</div>"+a+"<div>"+(p.bottomText||"")+"</div>",ne(n.document.body).addClass("html-view"),ne("img",n.document.body).each(function(e,t){t.setAttribute("src",l(t.getAttribute("src")))}),ne.jgrid.isFunction(p.onBeforeExport)&&p.onBeforeExport.call(v,n),Boolean(n.chrome)?p.autoPrint&&(n.print(),n.close()):setTimeout(function(){p.autoPrint&&(n.print(),n.close())},1e3)}ne.jgrid.isFunction(p.loadIndicator)?p.loadIndicator.call(v,"hide"):p.loadIndicator&&ne(v).jqGrid("progressBar",{method:"hide",loadtype:v.p.loadui})}),s}})});